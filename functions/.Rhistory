library(sf)
library(dplyr)
library(raster)
library(fasterize)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(getSourceEditorContext()$path))
install.packages("rstudioapi")
library(rstudioapi)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
gwd
pwd
dir()
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
install.packages("rgdal")
library(rgdal)
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
# Load urban land cover in 2015 from GHSL
smod_2015 <- raster(file.path('..', 'data', 'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0', 'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0.tif'))
# Load suitability for urban expansion
suitability <- raster(file.path('..', 'data', 'suitability', 'suitability_pca2_excluded.tif'))
# Load Urban Land (km2) projections
tbl_urban_land <- readr::read_csv(file.path('..', 'results', 'urban_land.csv'), show_col_types = F)
# List of countries available in urban land projections
lst_countries <- unique(tbl_urban_land$REGION)
lst_countries
iso <- 'CHN'
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
nrow(country)
# Create mask for the country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015,
file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Interpolate suitability to the country
suit_ctry <- raster::resample(suitability, urban_ctry_2015, method='ngb')
plot(suit_ctry)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='ngb') %>%
raster::mask(mask_ctry)
plot(suit_ctry)
iso
# Print country name
print(paste('Processing', iso))
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
raster::mask(mask_ctry)
iso <- 'CHN'
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
country
# Create mask for the country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
raster::mask(suitability)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
raster::mask(suitability) %>%
raster::mask(mask_ctry)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
plot(suit_ctry)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
raster::mask(mask_ctry)
plot(suit_ctry)
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
# Create directory for the country
dir.create(file.path('..', 'results', iso))
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
iso
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
library(sf)
library(rgdal)
library(dplyr)
library(raster)
library(fasterize)
library(rstudioapi)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
# Load urban land cover in 2015 from GHSL
smod_2015 <- raster(
file.path('..', 'data',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0.tif'))
# Load urban suitability (global coverage)
suitability <- raster(file.path('..', 'data', 'suitability', 'suitability_pca2_excluded.tif'))
# Load Urban Land (km2) projections
tbl_urban_land <- readr::read_csv(file.path('..', 'results', 'urban_land.csv'), show_col_types = F)
# List of countries available in urban land projections
lst_countries <- unique(tbl_urban_land$REGION)
iso <- 'USA'
# Print country name
print(paste('Processing', iso))
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
if(nrow(country)>0) {
# Create mask for the country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
# raster::mask(suitability) %>%
raster::mask(mask_ctry)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
}
raster::rotate(urban_ctry_2015) %>% plot()
raster::rotate(urban_ctry_2015)
raster::rotated(urban_ctry_2015)
raster::rotate(urban_ctry_2015)
country$geometry %>% plot()
country$geometry %>% plot(axes=T)
iso=='USA'
country %>% geometry()
country %>% st_geometry()
country %>% st_geometry() %>% st_cast('POLYGON')
usa_polygons <- country %>%
st_geometry() %>% st_cast('POLYGON')
usa_polygons
usa_polygons <- country %>%
st_geometry() %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84')
usa_polygons
country %>%
st_geometry() %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84') %>%
st_centroid()
usa_polygons
usa_polygons
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84')
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84') %>%
dplyr::filter(long = st_centroid(geometry)[1])
countries
countries <- ne_download(scale = 10, returnclass = 'sf')
countries
countries %>% filter(ADM0_A3=='USA')
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84') %>%
dplyr::filter(long = st_centroid(geometry)[1])
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84') %>%
dplyr::filter(long = function(x){st_centroid(x)[1]})
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84')
country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84') %>%
dplyr::filter(long = st_centroid(geometry))
usa_polygons <- country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84')
usa_polygons
usa_centroids <- st_centroid(usa_polygons)
usa_centroids
usa_centroids$geometry[1]
usa_centroids[,'geometry']
usa_centroids[,'geometry'][1]
usa_centroids$geometry
usa_centroids$geometry[1]
st_coords(usa_centroids)
st_coordinates(usa_centroids)
usa_polygons$ct_long <- st_coordinates(usa_centroids)[1]
usa_polygons
usa_polygons <- usa_polygons %>%
dplyr::filter(ct_long < 0)
plot(usa_polygons)
usa_polygons <- usa_polygons %>%
dplyr::filter(ct_long < 0)
usa_polygons
usa_centroids
usa_polygons$ct_long %>% summary()
st_centroid(usa_polygons)
usa_polygons <- country %>%
st_cast('POLYGON') %>%
st_transform(crs = 'WGS84')
usa_centroids <- st_centroid(usa_polygons)
usa_centroids
usa_polygons$ct_long <- st_coordinates(usa_centroids)[1]
usa_polygons
st_coordinates(usa_centroids)[1]
st_coordinates(usa_centroids)
st_coordinates(usa_centroids)[1,]
st_coordinates(usa_centroids)[,1]
usa_polygons$ct_long <- st_coordinates(usa_centroids)[,1]
usa_polygons
usa_polygons <- usa_polygons %>%
dplyr::filter(ct_long < 0)
plot(usa_polygons)
usa_polygons
country <- usa_polygons %>%
dplyr::filter(ct_long < 0) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs') %>%
dplyr::group_by(ADM0_A3) %>%
dplyr::summarise()
country
country %>% plot(axes=T)
if(nrow(country)>0) {
# Create mask for the country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
# raster::mask(suitability) %>%
raster::mask(mask_ctry)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
}
country
country %>% plot(axes=T)
# Create mask for the country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
mask_ctry %>% plot(axes=T)
mask_ctry
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
smod_ctry_2015
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
# raster::mask(suitability) %>%
raster::mask(mask_ctry)
suit_ctry
suit_ctry %>% raster::extent()
suit_ctry %>% st_bbox()
suit_ctry %>% plot(axes=T)
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
urban_ctry_2015 %>% plot(axes=T)
library(sf)
library(rgdal)
library(dplyr)
library(raster)
library(fasterize)
library(rstudioapi)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
urban_ctry_2015 %>% plot(axes=T)
library(sf)
library(rgdal)
library(dplyr)
library(raster)
library(fasterize)
library(rstudioapi)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
# Load urban land cover in 2015 from GHSL
smod_2015 <- raster(
file.path('..', 'data',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0.tif'))
# Load urban suitability (global coverage)
suitability <- raster(file.path('..', 'data', 'suitability', 'suitability_pca2_excluded.tif'))
# Load Urban Land (km2) projections
tbl_urban_land <- readr::read_csv(file.path('..', 'results', 'urban_land.csv'), show_col_types = F)
# List of countries available in urban land projections
lst_countries <- unique(tbl_urban_land$REGION)
iso <- 'USA'
print(paste('Processing', iso))
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
# Remove eastern pacific islands from USA
if(iso=='USA') {
usa_polygons <- country %>%
sf::st_cast('POLYGON') %>%
sf::st_transform(crs = 'WGS84')
usa_centroids <- sf::st_centroid(usa_polygons)
usa_polygons$ct_long <- sf::st_coordinates(usa_centroids)[,1]
country <- usa_polygons %>%
dplyr::filter(ct_long < 0) %>%
sf::st_transform(crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs') %>%
dplyr::group_by(ADM0_A3) %>%
dplyr::summarise()
}
country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
# raster::mask(suitability) %>%
raster::mask(mask_ctry)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
urban_ctry_2015
raster(file.path('..', 'results', iso, 'urban_2015.tif'))
raster(file.path('..', 'results', iso, 'urban_2015.tif'))
library(sf)
library(rgdal)
library(dplyr)
library(raster)
library(fasterize)
library(rstudioapi)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
# Load urban land cover in 2015 from GHSL
smod_2015 <- raster(
file.path('..', 'data',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0.tif'))
# Load urban suitability (global coverage)
suitability <- raster(file.path('..', 'data', 'suitability', 'suitability_pca2_excluded.tif'))
# Load Urban Land (km2) projections
tbl_urban_land <- readr::read_csv(file.path('..', 'results', 'urban_land.csv'), show_col_types = F)
# List of countries available in urban land projections
lst_countries <- unique(tbl_urban_land$REGION)
# Only China, India, US for demo
# lst_countries <- c('CHN', 'IND', 'USA')
lst_countries
iso = lst_contries(1)
iso = lst_contries[1]
lst_countries[1]
iso <- lst_countries[1]
iso
print(paste('Processing', iso))
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(
crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
country
mask_ctry <- country %>%
fasterize::fasterize(smod_2015) %>%
raster::crop(country)
# Crop the global SMOD layer to the country
smod_ctry_2015 <- smod_2015 %>%
raster::crop(mask_ctry) %>%
raster::mask(mask_ctry)
# Mark urban center (30) and dense urban cluster (23) as urban lands
urban_ctry_2015 <- (smod_ctry_2015>=23)
# Interpolate suitability to the country
suit_ctry <- suitability %>%
raster::resample(urban_ctry_2015, method='bilinear') %>%
# raster::mask(suitability) %>%
raster::mask(mask_ctry)
# Create directory for the country
dir.create(file.path('..', 'results', iso))
# Export urban land of the country in 2015
raster::writeRaster(urban_ctry_2015, overwrite=T,
filename=file.path('..', 'results', iso, 'urban_2015.tif'))
# Export urban suitability of the country
raster::writeRaster(suit_ctry, overwrite=T,
filename=file.path('..', 'results', iso, 'suitability.tif'))
