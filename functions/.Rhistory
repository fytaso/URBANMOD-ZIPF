library(sf)
library(rgdal)
library(dplyr)
library(raster)
library(fasterize)
library(rstudioapi)
library(rnaturalearth)
# Set working directory to path of the script
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
# Download country boundaries from Natural Earth
countries <- ne_download(scale = 10, returnclass = 'sf') %>%
dplyr::select(ADM0_A3, ADMIN)
# Load urban land cover in 2015 from GHSL
smod_2015 <- raster(
file.path('..', 'data',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0',
'GHS_SMOD_POP2015_GLOBE_R2019A_54009_1K_V2_0.tif'))
# Load urban suitability (global coverage)
suitability <- raster(file.path('..', 'data', 'suitability', 'suitability_pca2_excluded.tif'))
# Load Urban Land (km2) projections
tbl_urban_land <- readr::read_csv(file.path('..', 'results', 'urban_land.csv'), show_col_types = F)
# List of countries available in urban land projections
lst_countries <- unique(tbl_urban_land$REGION)
lst_countries
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
countries
country
country %>% plot()
country %>% geometry()
country$geometry
country$geometry %>% plot()
country %>%
sf::st_cast('POLYGON') %>%
sf::st_transform(crs = 'WGS84')
iso
iso=='RUS'
if(iso=='RUS') {
rus_polygons <- country %>%
sf::st_cast('POLYGON') %>%
sf::st_transform(crs = 'WGS84')
usa_centroids <- sf::st_centroid(rus_polygons)
rus_polygons$ct_long <- sf::st_coordinates(usa_centroids)[,1]
country <- rus_polygons %>%
dplyr::filter(ct_long > 0) %>%
sf::st_transform(
crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs') %>%
dplyr::group_by(ADM0_A3) %>%
dplyr::summarise()
}
country
country$geometry %>% plot()
iso <- 'FRA'
# Select and re-project country polygons
country <- countries %>%
dplyr::filter(ADM0_A3==iso) %>%
sf::st_transform(
crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs')
country$geometry %>% plot()
# Remove FG from France
if(iso=='FRA') {
fra_polygons <- country %>%
sf::st_cast('POLYGON') %>%
sf::st_transform(crs = 'WGS84')
usa_centroids <- sf::st_centroid(fra_polygons)
fra_polygons$ct_long <- sf::st_coordinates(usa_centroids)[,1]
fra_polygons$ct_lat  <- sf::st_coordinates(usa_centroids)[,2]
country <- fra_polygons %>%
dplyr::filter(ct_long > 0 & ct_lat > 0) %>%
sf::st_transform(
crs='+proj=moll +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs') %>%
dplyr::group_by(ADM0_A3) %>%
dplyr::summarise()
}
country$geometry %>% plot()
source("/Volumes/GoogleDrive/My Drive/Research_Projects/2017 URBANMOD-ZIPF/v3/URBANMOD-ZIPF/functions/urban_land_setup.R", echo=TRUE)
